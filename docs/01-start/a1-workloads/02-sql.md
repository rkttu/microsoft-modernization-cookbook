# SQL Server 및 데이터 분석

## 개요

**특성:**

- SQL Server를 기반으로 데이터 저장, 분석 및 보고서를 생성하는 시스템
- BI 도구(SSIS, SSRS, SSAS)와 결합하여 데이터 웨어하우스, 리포팅 시스템 등으로 활용됨
- 클라우드 환경에서는 Azure SQL Database로 현대화 전환 사례가 증가
- 데이터베이스 워크로드는 기업의 핵심 비즈니스 로직과 데이터가 포함되어 신중한 현대화 접근이 필요함

**사례 예시:**

- 제조업체의 생산 및 품질 데이터 분석
- 금융기관의 리스크 관리 및 보고 시스템
- 유통업체의 재고 관리 및 예측 분석
- 의료기관의 환자 데이터 분석 및 임상 의사결정 지원 시스템
- 공공기관의 대규모 통계 처리 및 데이터 웨어하우징

**현대화 전략 선택 기준:**

| 고려사항 | 리호스팅 | 리플랫포밍 | 리팩토링 |
|--------|----------|-----------|---------|
| 데이터베이스 크기 | 모든 크기 | 소-중규모 | 모든 크기(분산 설계) |
| 기술적 복잡성 | 낮음 | 중간 | 높음 |
| 마이그레이션 소요 시간 | 일~주 단위 | 주~월 단위 | 월~분기 단위 |
| 다운타임 | 일정 시간 필요 | 최소화 가능 | 점진적 전환 가능 |
| TCO 절감 효과 | 단기: 낮음, 장기: 낮음 | 단기: 중간, 장기: 높음 | 단기: 낮음, 장기: 매우 높음 |
| 특수 기능 호환성 | 매우 높음 | 중간~높음 | 재설계 필요 |

## 리호스팅 (Lift-and-Shift)

**적용 상황:**

- 기존 온프레미스 SQL Server와 BI 도구(SSIS, SSRS, SSAS 등)를 그대로 클라우드(IaaS 기반 VM)로 이전할 때
- 최소한의 변경으로 데이터 저장소와 분석 기능을 빠르게 클라우드 환경에서 운영해야 하는 경우
- 데이터센터 철수나 하드웨어 노후화로 인한 긴급 마이그레이션이 필요할 때
- SQL Server 특수 기능(CLR 통합, 커스텀 확장 등)에 의존도가 높은 시스템의 경우

**기대 효과:**

- 신속한 클라우드 이전으로 데이터베이스 및 리포팅 기능을 유지
- 초기 투자와 다운타임 최소화
- 온프레미스 데이터센터 운영 비용 절감

**장점:**

- 기존 구조를 그대로 유지하므로 이전 리스크가 낮음
- 빠른 운영 전환으로 단기적으로 비즈니스 연속성 보장
- SQL Server 라이선스를 Azure Hybrid Benefit으로 전환하여 비용 절감 가능
- 모든 SQL Server 버전 및 기능에 대한 완전한 호환성 보장

**단점:**

- 클라우드 관리형 데이터베이스와 분석 서비스의 고급 기능(자동 확장, 고가용성, 비용 최적화)을 온전히 활용하지 못함
- 장기 운영 시 클라우드 환경에 최적화되지 않아 비용 효율성이 떨어질 수 있음
- 운영 관리 부담(패치, 백업, 고가용성 구성 등)이 여전히 존재
- 클라우드의 자동화 및 오케스트레이션 서비스와의 통합이 제한적

**Azure 서비스 매핑:**

- **Azure Virtual Machines**: SQL Server 설치된 VM
- **Azure Storage**: 데이터 백업 및 로그 저장
- **Azure Site Recovery**: DR(재해 복구) 구성
- **Azure Backup**: 데이터베이스 백업 자동화
- **Azure ExpressRoute/VPN**: 하이브리드 연결성

**마이그레이션 단계:**

1. **평가**: 데이터베이스 크기, 성능 특성, 종속성, 라이선스 상황 파악
2. **인프라 준비**: Azure VM 크기 선정, 네트워크 구성, 스토리지 최적화
3. **마이그레이션 방법 선택**:
   - 백업/복원
   - 상시 가용 그룹(Always On AG)
   - 데이터베이스 전송
   - Azure Site Recovery 활용
4. **테스트 마이그레이션**: 비프로덕션 환경에서 검증
5. **다운타임 최소화 전략**: 증분 백업/복원, 로그 전달, 데이터 동기화
6. **컷오버(Cutover)**: 최종 마이그레이션 및 애플리케이션 연결 전환
7. **유효성 검사**: 데이터 일관성, 성능, 응용 프로그램 연결성 확인

## 리플랫포밍 (Re-platforming)

**적용 상황:**

- Azure SQL Database, Amazon RDS 등 관리형 데이터베이스 서비스로 이전하여 관리 부담을 줄이고자 할 때
- 기존 SQL Server 인스턴스를 약간의 수정(예: 데이터베이스 구성, 연결 방식 변경)으로 클라우드 서비스로 전환
- 자동 확장, 자동 백업, 고가용성과 같은 관리형 서비스의 이점을 활용하고자 할 때
- 인프라 운영보다 데이터와 애플리케이션에 집중하려는 조직에 적합

**기대 효과:**

- 관리형 서비스의 자동 백업, 패치 관리, 확장성 등 클라우드 네이티브 기능 활용
- 운영 및 유지보수 비용 절감
- 보안 및 규정 준수 관리 용이성 증가
- 개발 및 테스트 환경의 유연한 프로비저닝

**장점:**

- 코드 변경 없이 데이터베이스 기능을 향상시킬 수 있음
- 데이터 분석 도구와 클라우드 데이터 웨어하우스(Azure Synapse, Amazon Redshift) 연동 용이
- 자동화된 백업 및 재해 복구 기능으로 비즈니스 연속성 향상
- 성능에 따른 자동 확장으로 비용 효율성 증가
- 서버 관리 부담 대폭 감소

**단점:**

- 일부 사용자 지정 기능이 제한될 수 있음(CLR, 확장 저장 프로시저, FileStream 등)
- 약간의 재구성이 필요하여 이전 과정에 추가 노력이 요구됨
- 관리형 서비스의 제약사항에 따라 애플리케이션 로직 일부 수정 필요
- 클라우드 서비스에 대한 종속성 증가

**Azure 서비스 매핑:**

- **Azure SQL Database**: 완전 관리형 PaaS 데이터베이스
- **Azure SQL Managed Instance**: 거의 100% SQL Server 호환성 제공
- **Azure Database Migration Service**: 마이그레이션 프로세스 자동화
- **Azure Data Factory**: ETL/ELT 워크플로우 오케스트레이션
- **Power BI**: 기존 SSRS 보고서 대체 및 시각화
- **Azure Analysis Services**: 기존 SSAS 워크로드 대체

**마이그레이션 단계:**

1. **호환성 평가**: Data Migration Assistant(DMA)를 사용한 호환성 검사
2. **SKU 선정**: 성능 요구사항에 맞는 서비스 계층 및 컴퓨팅 크기 선택
3. **스키마 이전**: 스키마 비교 도구를 사용한 테이블, 인덱스, 저장 프로시저 등 마이그레이션
4. **데이터 마이그레이션 방법 선택**:
   - Azure Database Migration Service
   - 백업/복원(SQL Managed Instance)
   - 데이터 내보내기/가져오기
   - 트랜잭션 복제
5. **ETL/데이터 처리 파이프라인 조정**: SSIS 패키지를 Data Factory로 마이그레이션
6. **연결 문자열 및 보안 수정**: 연결 정보 업데이트, Azure AD 인증 구성
7. **성능 테스트 및 최적화**: 쿼리 성능 분석 및 인덱싱 조정

## 리팩토링 (Refactoring)

**적용 상황:**

- 데이터 분석 파이프라인 및 ETL 프로세스를 클라우드 네이티브 아키텍처(예: 서버리스 데이터 파이프라인, 컨테이너 기반 분석)를 통해 재설계하고자 할 때
- 데이터 모델 및 분석 워크플로우를 새롭게 최적화해 실시간 인사이트를 제공하려는 경우
- 빅데이터, IoT, AI/ML 등 첨단 분석 기능을 도입하고자 하는 경우
- 폴리글랏 퍼시스턴스(여러 데이터 저장소 유형 사용)로 전환하여 다양한 워크로드에 최적화된 데이터 스토어 활용

**기대 효과:**

- 분석 성능, 확장성, 실시간 처리 능력 크게 개선
- 비용 효율화 및 운영 자동화를 통한 장기적 운영비 절감
- 데이터 기반 의사결정 및 인공지능 도입 가속화
- 글로벌 데이터 환경에서의 확장성 및 성능 최적화

**장점:**

- 최신 데이터 분석 및 AI/ML 기능과의 통합이 용이
- 데이터 파이프라인의 유연성 및 민첩성이 극대화됨
- 서버리스 아키텍처를 통한 탄력적 확장 및 비용 최적화
- 다양한 데이터 형식과 볼륨 처리에 최적화된 구조
- 실시간 분석 및 이벤트 기반 처리 활용 가능

**단점:**

- 재설계에 따른 개발 시간과 비용이 크게 증가할 수 있음
- 전환 과정에서 데이터 마이그레이션 및 테스트에 추가 리스크 존재
- 데이터 거버넌스 및 보안 모델 재정립 필요
- 새로운 기술에 대한 조직의 학습 곡선
- 기존 데이터베이스 전문 기술의 일부 재활용 어려움

**Azure 서비스 매핑:**

- **Azure Synapse Analytics**: 통합 데이터 웨어하우스 및 분석
- **Azure Cosmos DB**: 글로벌 분산 NoSQL 데이터베이스
- **Azure Databricks**: 빅데이터 분석 및 AI 통합
- **Azure Stream Analytics**: 실시간 이벤트 처리
- **Azure Functions**: 서버리스 데이터 처리
- **Azure Cognitive Services**: AI 기반 데이터 분석
- **Azure Event Hubs/IoT Hub**: 대규모 텔레메트리 수집

**마이그레이션 단계:**

1. **데이터 아키텍처 설계**: 폴리글랏 퍼시스턴스 전략, 데이터 레이크/웨어하우스 설계
2. **데이터 모델 변환**: 관계형 모델에서 목적별 최적화된 데이터 모델로 전환
3. **마이크로서비스 기반 데이터 접근 계층**: 도메인별 데이터 액세스 API 개발
4. **ETL에서 ELT로 전환**: 클라우드 규모의 데이터 처리 패러다임 적용
5. **실시간 데이터 파이프라인 구축**: 스트리밍 분석 및 이벤트 처리
6. **AI/ML 통합**: 예측 분석 및 지능형 데이터 처리 구현
7. **데이터 거버넌스 구현**: 메타데이터 관리, 데이터 카탈로그, 품질 관리
8. **CI/CD 파이프라인**: 데이터베이스 스키마 및 ETL 코드 자동화 배포

## 가상의 사례: 국내 대형 제조사 데이터 플랫폼 현대화

**배경**: 자동차 부품 제조사의 온프레미스 SQL Server 기반 생산 데이터 관리 시스템

**도전 과제**:
- 글로벌 생산 시설로부터의 대용량 센서 데이터 처리 필요
- 실시간 품질 모니터링 및 예측 유지보수 요구
- 레거시 OLTP 및 OLAP 시스템의 확장성 한계
- 글로벌 비즈니스 연속성 보장 필요

**접근 방법**: 3단계 현대화 전략
1. **단기**(3~6개월): OLTP 워크로드를 Azure SQL Managed Instance로 리플랫포밍
2. **중기**(6~12개월): 데이터 웨어하우스를 Azure Synapse Analytics로 마이그레이션
3. **장기**(12~18개월): IoT 데이터는 Cosmos DB로, 실시간 분석은 Stream Analytics와 Databricks로 리팩토링

**결과**:
- 데이터 처리 지연 시간 85% 감소 (하루 → 1시간 이내)
- 예측 유지보수를 통한 설비 다운타임 35% 절감
- 글로벌 데이터 일관성 및 가용성 확보
- 분석 인프라 TCO 45% 절감

## 고려해야 할 특수 마이그레이션 시나리오

### 1. 고가용성 및 재해 복구(HA/DR) 마이그레이션

**주요 고려사항**:
- Always On 가용성 그룹을 Azure VM, SQL Managed Instance 또는 복제 토폴로지로 전환
- 기존 로그 전달(Log Shipping) 방식에서 Azure 기반 지역 간 복제로 전환
- RTOs(복구 시간 목표) 및 RPOs(복구 지점 목표) 재정의

**권장 접근법**:
- SQL Managed Instance의 경우 자동 백업 및 지역 간 복제 활용
- IaaS의 경우 Azure Site Recovery와 SQL Always On 조합 구성
- 업무 중요도에 따른 계층화된 HA/DR 전략 수립

### 2. 대규모 및 중요 데이터베이스 마이그레이션

**주요 고려사항**:
- 테라바이트 규모 데이터베이스 이전 전략
- 최소 다운타임 요구사항 충족 방안
- 성능 병목 현상 및 데이터 일관성 보장

**권장 접근법**:
- 오프라인 백업 전송 + 온라인 트랜잭션 로그 적용의 하이브리드 접근
- Azure Data Box를 활용한 대용량 초기 마이그레이션
- 단계적 마이그레이션으로 리스크 최소화
- 병렬 운영 기간 설정 및 철저한 검증

### 3. 레거시 SQL Server 버전 마이그레이션

**주요 고려사항**:
- SQL Server 2008/2005 등 지원 종료된 버전의 처리
- 애플리케이션 호환성 및 사용되지 않는 기능 대체
- 버전 간 차이로 인한 쿼리 성능 변화

**권장 접근법**:
- 다중 단계 업그레이드 (예: 2008 → 2016 → Azure SQL)
- 단계별 회귀 테스트 및 성능 검증
- 애플리케이션 코드 리팩토링과 병행 진행

## 마이그레이션 도구 및 리소스

**평가 및 계획**:
- [Data Migration Assistant (DMA)](https://docs.microsoft.com/ko-kr/sql/dma/dma-overview): 호환성 이슈 사전 식별
- [Azure Migrate](https://azure.microsoft.com/ko-kr/services/azure-migrate/): 종합적 마이그레이션 평가 및 계획
- [Database Experimentation Assistant](https://docs.microsoft.com/ko-kr/sql/dea/database-experimentation-assistant-overview): SQL Server 버전 간 워크로드 성능 비교

**마이그레이션 수행**:
- [Azure Database Migration Service](https://docs.microsoft.com/ko-kr/azure/dms/dms-overview): 최소 다운타임 온라인 마이그레이션
- [SqlPackage](https://docs.microsoft.com/ko-kr/sql/tools/sqlpackage): BACPAC 형식으로 데이터베이스 내보내기/가져오기
- [Azure Data Factory](https://docs.microsoft.com/ko-kr/azure/data-factory/): 데이터 이동 및 변환 오케스트레이션

**모니터링 및 최적화**:
- [Azure Monitor](https://docs.microsoft.com/ko-kr/azure/azure-monitor/): 데이터베이스 성능 및 상태 모니터링
- [Query Performance Insight](https://docs.microsoft.com/ko-kr/azure/azure-sql/database/query-performance-insight-use): 성능 저하 쿼리 식별 및 최적화
- [Azure SQL Analytics](https://docs.microsoft.com/ko-kr/azure/azure-monitor/insights/azure-sql): 데이터베이스 성능 분석 및 문제 해결

## 마이그레이션 후 최적화 및 현대화

**성능 최적화**:
- 클라우드 환경에 맞는 인덱싱 전략 재수립
- 자동 조정 및 지능형 성능 기능 활용
- 쿼리 저장소(Query Store)를 활용한 성능 모니터링 및 플랜 강제 적용
- 읽기 복제본을 통한 읽기/쓰기 부하 분리

**비용 최적화**:
- 서버리스 컴퓨팅 옵션으로 사용량 기반 비용 모델 활용
- 탄력적 풀을 통한 다중 데이터베이스 리소스 공유
- 자동 확장/축소 구성으로 피크 시간대 처리
- Azure Hybrid Benefit 및 예약 인스턴스를 통한 비용 절감

**보안 강화**:
- Always Encrypted를 통한 민감 데이터 보호
- Azure Active Directory 통합 인증
- 동적 데이터 마스킹 및 행 수준 보안
- 고급 위협 방지 및 취약점 평가 활성화

**데이터 현대화 다음 단계**:
- 그래프 데이터베이스 기능을 활용한 관계 분석
- JSON 지원을 통한 스키마 유연성 확보
- 데이터베이스 내 머신러닝(ML Services) 활용
- 하이브리드 트랜잭션/분석 처리(HTAP) 아키텍처 도입
